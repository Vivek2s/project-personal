<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/all.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
      .error{
        background:rgb(243, 195, 176);
        border:1px solid red;
        padding:10px;
        margin-bottom:10px
      }
    </style>
  </head>
  <body>

    <div class="container">
        <h4 class="shadow-lg p-3 mb-5  rounded   bg-info text-white"><%= title %></h4>
  
      </div>

      <div class="container">
        <div class="panel-title" style="font-weight: 900; font-size: large;"> <i onclick="history.back()" class="fa fa-arrow-left"></i> Add new Contact</div>
        <form action="/" class="form-horizontal" role="form" method="post">
            <div class="form-group">
                <label for="name" >Name</label>
                
                  <input id="uname" type="text" class="form-control" name="uname" placeholder="Enter your name">
                
              </div>
              <div class="form-group" id="form-email">
                <label for="email" >Email</label>
                
                  <input id="email" type="text" class="form-control" name="email" placeholder="Enter your Email">
                  <a class="btn btn-info" onclick="addEmail()" ><i class="fas fa-envelope-square"></i></a>
                
              </div>

              <div class="form-group" id="form-number" >
                <label for="emptype" >Phone-Number</label>
                
                  <input id="contact" type="number" name="number" class="form-control" placeholder="Enter your Phone-Number">
                  <a class="btn btn-info" onclick="addNumber()" ><i class="fa fa-phone"></i></a>

                            
              </div>

              <div class="form-group">
                <label for="hrlyrate"  >Date of birth </label>
        
                  <input id="dob" type='text' class="form-control" name="dob" placeholder="Enter your date of birth">
                

              </div>
              <div class="error"></div>

          
         
              <div class="form-group">
                <div class="col-md-offset-3 col-md-9">
                    <a href="/">
                  <input id="submit" name="submit" type="button" class="btn btn-info"  value="submit">
                 </a>
                </div>
              </div>
        </form>
      </div>
    <script>
      $(document).ready(e=>{
        $(".error").hide();
        $("#submit").click(e=>{
          e.preventDefault();
          $(".error").text("");
          $(".error").show();
          validateForm();
        })
      })
      function validateForm(){
        let fields = ["uname","email","contact","dob"];
          for(e of fields){
            if($("#"+e).val()==""){
              $("#"+e).focus()
              error(e+" can't be empty");
              if(e == "contact" && $("#"+e).val().length < 10){
                error("Mobile number length should be atleast 10")
              }
              return;
            }
          }
          validateEmail();
      }
      function validateEmail(){
        if(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test($("#email").val())){
          return validateDate();
        }
        else{
          $(".error").text("Email is not valid");
          $("#email").focus();
          error("Invalid email");
        }
      }
      function validateDate(){
        console.log($("#dob").val());
        let val = $("#dob").val();
        if(/^(0?[1-9]|[12][0-9]|3[01])[\/\-](0?[1-9]|1[012])[\/\-]\d{4}$/.test(val)){
          submitForm()
        }
        else{
        $("#dob").focus();
        error("Invalid Date format\nThe date should be in format dd-mm-yyyy or dd/mm/yyyy");
          return false;
        }
      }
      function error(text="Error occured",color="#a30505"){
        $(".error").text(text);
        $(".error").css("color",color);
      }
      function submitForm(){
        let data = {};
        [...document.forms[0]].forEach(element => {
          data[element.name] = element.value;
        });
        $(".error").hide();
        fetch("/",{
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body:JSON.stringify(data)
        })
        .then(e=>{
          location.href = "/"
        })
      }
    </script>
  </body>
  <script>

    function addNumber(){
     
        var html = `
         <div class="ph">
        <label for="usr">Other Number:</label>
      <input name="other" type="number" class="form-control" >
      <a class="btn btn-danger" ><i class="fa fa-trash"></i></a>
      </div
        `;
        
        $('#form-number').append(html);
    }
    
    
    $(document).ready(function(){
    $(document).on('click', '.delete', function(e){ 
         // Your Code
         var obj = JSON.parse(JSON.stringify(e));
        var d =  $(this).parent('.ph').remove();
         console.log('dawdawdaw', d);
    });
    
    
    
    
    });
     </script>
    
     <script>
      function addEmail(){
     
     var html = `
      <div class="ph">
     <label for="usr">Other Email:</label>
    <input name="email" type="email" class="form-control" >
    
    <a class="btn btn-danger" ><i class="fa fa-trash"></i></a>
    </div
     `;
     
     $('#form-email').append(html);
    }
    
    
    $(document).ready(function(){
    $(document).on('click', '.delete', function(e){ 
      // Your Code
      var obj = JSON.parse(JSON.stringify(e));
     var d =  $(this).parent('.ph').remove();
      console.log('dawdawdaw', d);
    });
    
    
    
    
    });
    
    
     </script>

</html>
